services:

  google_spreadsheet:
    class: PSL\ClipperBundle\Service\GoogleSpreadsheetService
    arguments: [%google_spreadsheets%]

  rpanel:
    class: PSL\ClipperBundle\Service\RPanelService
    arguments: [%rpanel%]

  survey_builder:
    class: PSL\ClipperBundle\Service\SurveyBuilderService
    # @TODO: only get templating
    arguments: [@service_container]
  limesurvey:
    class: PSL\ClipperBundle\Utils\LimeSurvey

  explode_tree:
    class: PSL\ClipperBundle\Utils\ExplodeTree

  survey_chart_map:
    class: PSL\ClipperBundle\Charts\SurveyChartMap

  chart_assembler:
    class: PSL\ClipperBundle\Charts\Assembler
    arguments: [@service_container]

  clipper_serializer:
    class: PSL\ClipperBundle\Utils\ClipperSerializer

  yaml_admin_user_provider:
    class: PSL\ClipperBundle\Security\User\YamlAdminUserProvider
    arguments: ["%kernel.root_dir%/Resources/users.yml"]

  fw_sso_user_provider:
    class: PSL\ClipperBundle\Security\User\FWSSOUserProvider
    arguments: ["@service_container"]

  fw_sso_quick_login_user_provider:
    class: PSL\ClipperBundle\Security\User\FWSSOQuickLoginUserProvider
    arguments: ["@service_container"]

  fw_sso_webservice:
    class: PSL\ClipperBundle\Service\FWSSOWebservice

  drupal_password_encoder:
    class: PSL\ClipperBundle\Service\DrupalPasswordEncoder
    arguments: ["@service_container"]

  # --------------------------- #
  #   Clipper event listeners   #
  # --------------------------- #

  # Listeners are called in descending order by priority. Highest priority is called first.

  clipper.listener.order_complete:
    class: PSL\ClipperBundle\Listener\LimeSurveyPending
    arguments: ["@service_container", "limesurvey_pending"]
    tags:
      - { name: kernel.event_listener, event: fq_process, method: onMain, priority: 100 }

  clipper.listener.limesurvey_created:
    class: PSL\ClipperBundle\Listener\LimeSurveyCreated
    arguments: ["@service_container", "limesurvey_created"]
    tags:
      - { name: kernel.event_listener, event: fq_process, method: onMain, priority: 90 }

  clipper.listener.rpanel_complete:
    class: PSL\ClipperBundle\Listener\RpanelComplete
    arguments: ["@service_container", "rpanel_complete"]
    tags:
      - { name: kernel.event_listener, event: fq_process, method: onMain, priority: 80 }

  clipper.listener.limesurvey_complete:
    class: PSL\ClipperBundle\Listener\LimeSurveyComplete
    arguments: ["@service_container", "limesurvey_complete"]
    tags:
      - { name: kernel.event_listener, event: fq_process, method: onMain, priority: 70 }

  # refresh responses
  clipper.listener.limesurvey_responses:
    class: PSL\ClipperBundle\Listener\LimeSurveyResponses
    arguments: ["@service_container"]
    tags:
      - { name: kernel.event_listener, event: ls_refresh_responses, method: refreshResponses, priority: 0 }
      - { name: kernel.event_listener, event: after_limesurvey_complete, method: refreshResponses, priority: 0 }

  # types of charts
  clipper.chart.net_promoters:
    class: PSL\ClipperBundle\Charts\Types\NetPromoters
    arguments: ["@service_container", "net_promoters"]
    tags:
      - { name: kernel.event_listener, event: chart_process, method: onDataTable, priority: 0 }

  clipper.chart.devoted_doctor_to_brands:
    class: PSL\ClipperBundle\Charts\Types\DevotedDoctorToBrands
    arguments: ["@service_container", "devoted_doctor_to_brands"]
    tags:
      - { name: kernel.event_listener, event: chart_process, method: onDataTable, priority: 0 }

  clipper.chart.doctor_promoting_brands:
    class: PSL\ClipperBundle\Charts\Types\DoctorPromotingBrands
    arguments: ["@service_container", "doctor_promoting_brands"]
    tags:
      - { name: kernel.event_listener, event: chart_process, method: onDataTable, priority: 0 }

  clipper.chart.doctor_promoting_mine_also_others:
    class: PSL\ClipperBundle\Charts\Types\DoctorPromotingMineAlsoOthers
    arguments: ["@service_container", "doctor_promoting_mine_also_others"]
    tags:
      - { name: kernel.event_listener, event: chart_process, method: onDataTable, priority: 0 }

  clipper.chart.doctor_promoting_mine_also_others_table:
    class: PSL\ClipperBundle\Charts\Types\DoctorPromotingMineAlsoOthersTable
    arguments: ["@service_container", "doctor_promoting_mine_also_others_table"]
    tags:
      - { name: kernel.event_listener, event: chart_process, method: onDataTable, priority: 0 }

  clipper.chart.detractors_promotes_these_brands:
    class: PSL\ClipperBundle\Charts\Types\DetractorsPromotesTheseBrands
    arguments: ["@service_container", "detractors_promotes_these_brands"]
    tags:
      - { name: kernel.event_listener, event: chart_process, method: onDataTable, priority: 0 }